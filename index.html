<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>WoW | Word World</title>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

    <link rel="stylesheet" href="style.css">

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0f172a">

    <style>
        /* ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; } /* ëª¨ë°”ì¼ì€ 1ì—´ */
        }

        /* ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .stat-card {
            background: #25252d;
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid var(--border);
            min-height: 140px;
        }

        .stat-card .label { font-size: 0.85rem; color: var(--text-dim); font-weight: 600; }
        .stat-card .value { font-size: 1.8rem; font-weight: 800; margin-top: 5px; color: var(--text); }
        .stat-card .suffix { font-size: 1rem; color: var(--text-dim); font-weight: 500; }

        /* ì•„ì´ì½˜ ë°°ê²½ */
        .icon-bg {
            position: absolute; top: -10px; right: -10px;
            font-size: 5rem; opacity: 0.05; pointer-events: none;
        }

        /* ì§„í–‰ë°” */
        .mini-progress-bg {
            width: 100%; height: 6px; background: rgba(255,255,255,0.1);
            border-radius: 3px; margin-top: 15px; overflow: hidden;
        }
        .mini-progress-fill {
            height: 100%; background: var(--primary);
            border-radius: 3px; transition: width 0.5s ease;
        }

        /* ì¹´ë“œ ë‚´ë¶€ ë²„íŠ¼ */
        .btn-mini-start {
            margin-top: auto; /* í•˜ë‹¨ ê³ ì • */
            background: rgba(255, 215, 0, 0.15); color: var(--accent);
            border: none; padding: 10px; border-radius: 10px;
            font-size: 0.9rem; font-weight: 700; cursor: pointer;
            width: 100%; text-align: center;
            transition: background 0.2s;
        }
        .btn-mini-start:hover { background: var(--accent); color: #000; }

        .today-card .btn-mini-start { background: rgba(112, 224, 0, 0.15); color: var(--primary); }
        .today-card .btn-mini-start:hover { background: var(--primary); color: #000; }

        /* ì˜¤ëŠ˜ì˜ ì–´ì› ì¹´ë“œ */
        .etymology-card {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 20px; padding: 25px; margin-bottom: 25px;
            color: white; position: relative;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .ety-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .ety-badge { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 700; }
        .refresh-icon { background: none; border: none; color: rgba(255,255,255,0.5); font-size: 1.2rem; cursor: pointer; }
        .ety-content h3 { font-size: 1.8rem; font-weight: 900; margin-bottom: 10px; color: var(--accent); font-family: serif; }
        .ety-content p { font-size: 0.95rem; line-height: 1.6; color: #e0e0e0; word-break: keep-all; }

        /* ìŠ¤íŠ¸ë¦­ í—¤ë” ì •ë¦¬ */
        .streak-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%; }
        .streak-btns { display: flex; gap: 5px; }
        .streak-btns button {
            background: var(--bg); border: 1px solid var(--border);
            color: var(--text-dim); padding: 4px 10px; border-radius: 15px;
            font-size: 0.8rem; cursor: pointer;
        }
        .streak-btns button.active {
            background: var(--primary); color: #000; border-color: var(--primary); font-weight: 700;
        }
    </style>
</head>
<body>

<div id="customAlert">
    <div style="font-size:1.5rem;">ğŸ””</div>
    <div id="alertMsg" style="font-weight:600; font-size:1rem;">ë©”ì‹œì§€ ë‚´ìš©</div>
</div>
<div id="streakTooltip"></div>

<div id="wordListModal" class="modal-overlay" style="display: none;" onclick="closeModal(event)">
    <div class="modal-box">
        <h3 id="modalDate" style="font-size: 1.5rem; margin-bottom: 15px; color: var(--primary);">2024-01-01</h3>
        <div style="font-size: 0.9rem; color: var(--text-dim); border-bottom: 1px solid var(--border); padding-bottom: 10px;">í•™ìŠµí•œ ë‹¨ì–´ ëª©ë¡</div>
        <div id="modalListContent" class="word-list-scroll"></div>
        <button onclick="document.getElementById('wordListModal').style.display='none'" class="btn-main" style="margin-top:20px; padding:12px;">ë‹«ê¸°</button>
    </div>
</div>

<div id="customConfirmModal" class="modal-overlay" style="display: none;">
    <div class="confirm-box">
        <p id="confirmMsg">ë‚´ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤</p>
        <div class="confirm-btns">
            <button id="confirmNo" class="btn-cancel">ì·¨ì†Œ</button>
            <button id="confirmYes" class="btn-ok">í™•ì¸</button>
        </div>
    </div>
</div>

<div id="settingsOverlay">
    <div style="max-width: 500px; margin: 0 auto;">
        <h2 style="margin-bottom: 30px; display:flex; align-items:center; gap:10px;"><span style="font-size:1.8rem;">âš™ï¸</span> ì„¤ì •</h2>

        <div class="setting-row">
            <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">ë‹¨ì–´ ì „í™˜ ì†ë„</div>
                <div style="font-size: 0.85rem; color: var(--text-dim);">Preview ë‹¨ê³„ ìë™ ë„˜ê¹€</div>
            </div>
            <div class="setting-val">
                <button onclick="adjSetting('previewTime', -0.1)" class="setting-btn">-</button>
                <span id="previewTimeVal" style="min-width:50px; text-align:center; font-weight:800; font-size:1.2rem; font-variant-numeric: tabular-nums;">2.0s</span>
                <button onclick="adjSetting('previewTime', 0.1)" class="setting-btn">+</button>
            </div>
        </div>

        <div class="setting-row">
            <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">ì¬ì•”ê¸° ì‹œê°„</div>
                <div style="font-size: 0.85rem; color: var(--text-dim);">3ë‹¨ê³„ ëœ» ë³´ì—¬ì£¼ëŠ” ì‹œê°„</div>
            </div>
            <div class="setting-val">
                <button onclick="adjSetting('reLearnTime', -0.5)" class="setting-btn">-</button>
                <span id="reLearnTimeVal" style="min-width:50px; text-align:center; font-weight:800; font-size:1.2rem; font-variant-numeric: tabular-nums;">3.0s</span>
                <button onclick="adjSetting('reLearnTime', 0.5)" class="setting-btn">+</button>
            </div>
        </div>
        <div class="setting-row">
            <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">í•˜ë£¨ í•™ìŠµ ëª©í‘œ</div>
                <div style="font-size: 0.85rem; color: var(--text-dim);">í•œ ë²ˆì— í•™ìŠµí•  ë‹¨ì–´ ìˆ˜</div>
            </div>

            <div class="setting-val" style="gap: 5px; padding: 8px 10px;">
                <button onclick="adjSetting('dailyGoal', -10)" class="setting-btn" style="font-size: 0.75rem; padding: 0 6px;">-10</button>
                <button onclick="adjSetting('dailyGoal', -1)" class="setting-btn" style="font-size: 1.2rem;">-</button>
                <span id="dailyGoalVal" style="min-width:40px; text-align:center; font-weight:800; font-size:1.3rem; font-variant-numeric: tabular-nums;">20</span>
                <button onclick="adjSetting('dailyGoal', 1)" class="setting-btn" style="font-size: 1.2rem;">+</button>
                <button onclick="adjSetting('dailyGoal', 10)" class="setting-btn" style="font-size: 0.75rem; padding: 0 6px;">+10</button>
            </div>
        </div>
        <div class="setting-row">
            <label>open router API í‚¤</label>
            <div class="setting-val api-key-wrapper">
                <input type="password" id="settingsApiKey" placeholder="API í‚¤ ì…ë ¥" />

                <button type="button" class="toggle-visibility" onclick="toggleApiKey()" title="ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°">
                    <svg class="eye open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                        <path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
                        <circle cx="12" cy="12" r="2.5"/>
                    </svg>
                    <svg class="eye closed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor" style="display:none;">
                        <path d="M17.94 17.94l-14-14m0 0L17.94 17.94M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
                    </svg>
                </button>

                <button type="button" class="save-btn" id="saveApiKeyBtn" title="ì €ì¥">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                        <path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zM5 5h11v4H5V5zm0 14v-9h14v9H5z"/>
                    </svg>
                </button>
            </div>
        </div>

        <button class="btn-main" onclick="toggleSettings()">ë‹«ê¸°</button>
    </div>
</div>

<section id="page-auth" class="page" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;">
    <h1 style="font-size: 4.5rem; font-weight: 900; color: var(--primary); margin-bottom: 15px; text-shadow: 0 0 30px var(--primary-glow);">WoW</h1>
    <button onclick="login()" class="btn-main" style="max-width: 320px;">Google ê³„ì •ìœ¼ë¡œ ì‹œì‘</button>
</section>

<nav class="sidebar" id="sidebar">
    <div style="font-size: 2rem; font-weight: 900; color: var(--primary); margin-bottom: 50px; padding-left: 10px; letter-spacing: -1px;">WoW</div>
    <button class="nav-btn nav-home" onclick="showPage('home')"><span class="icon">ğŸ </span> ëŒ€ì‹œë³´ë“œ</button>
    <button class="nav-btn nav-manage" onclick="showPage('manage')"><span class="icon">ğŸ“</span> ë‹¨ì–´ ê´€ë¦¬</button>
    <button class="nav-btn" onclick="toggleSettings()"><span class="icon">âš™ï¸</span> ì„¤ì •</button>
    <button class="nav-btn" onclick="logout()" style="color:var(--error); margin-top:auto;"><span class="icon">ğŸšª</span> ë¡œê·¸ì•„ì›ƒ</button>
</nav>

<nav class="mobile-nav" id="mobileNav">
    <button class="nav-btn nav-home" onclick="showPage('home')"><span class="icon">ğŸ </span><span>í™ˆ</span></button>
    <button class="nav-btn nav-manage" onclick="showPage('manage')"><span class="icon">ğŸ“</span><span>ê´€ë¦¬</span></button>
    <button class="nav-btn" onclick="toggleSettings()"><span class="icon">âš™ï¸</span><span>ì„¤ì •</span></button>
    <button class="nav-btn" onclick="logout()" style="color:var(--error);"><span class="icon">ğŸšª</span><span>ì¢…ë£Œ</span></button>
</nav>

<main class="main" id="mainArea" style="display:none;">
    <div class="container">

        <section id="page-home" class="page">
            <header class="dashboard-header" style="margin-bottom: 25px; display: flex; justify-content: space-between; align-items: flex-end;">
                <div>
                    <div style="font-size:0.9rem; color:var(--text-dim);" id="currentDateDisp">Loading...</div>
                    <h2 style="font-size:1.6rem; margin-top:5px;">
                        Hello, <span id="userNameDisp" style="color:var(--accent);">User</span>! ğŸ‘‹
                    </h2>
                </div>
            </header>

            <div id="resumeBanner" style="display:none; margin-bottom: 20px;"></div>

            <div id="heroArea" class="hero-card" style="display:none;">
                <div class="hero-title">ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</div>
                <div class="hero-count" id="heroCount">0</div>
                <div class="hero-goal">/ <span id="heroGoal">20</span></div>
                <button class="btn-hero-start" onclick="startDailySession()">í•™ìŠµ ì‹œì‘í•˜ê¸° ğŸš€</button>
            </div>

            <div class="stats-grid">
                <div id="todaySmallCard" class="stat-card today-card" style="display:none;">
                    <div class="icon-bg">ğŸ”¥</div>
                    <div class="stat-info">
                        <span class="label">ì˜¤ëŠ˜ì˜ í•™ìŠµ</span>
                        <div class="value">
                            <span id="countToday">0</span>
                            <span class="suffix">/ <span id="goalDisp">20</span></span>
                        </div>
                    </div>
                    <div class="mini-progress-bg">
                        <div id="todayProgressBar" class="mini-progress-fill" style="width: 0%"></div>
                    </div>
                    <div style="margin-top:15px; font-weight:700; color:var(--primary); font-size:0.9rem; text-align:center;">
                        ğŸ‰ ëª©í‘œ ë‹¬ì„± ì™„ë£Œ!
                    </div>
                </div>

                <div class="stat-card review-card" id="reviewCardObj">
                    <div class="icon-bg">ğŸ§ </div>
                    <div class="stat-info">
                        <span class="label">ë³µìŠµ í•„ìš”</span>
                        <div class="value" id="countReview" style="color:var(--accent);">0</div>
                    </div>
                    <div style="flex-grow:1;"></div>
                    <button class="btn-mini-start" onclick="startReviewSession()">ë³µìŠµí•˜ê¸°</button>
                </div>
            </div>

            <div class="etymology-card">
                <div class="ety-header">
                    <span class="ety-badge">ğŸ§ ì˜¤ëŠ˜ì˜ ì–´ì›</span>
                </div>
                <div class="ety-content">
                    <h3 id="etyWord">Loading...</h3>
                    <p id="etyDesc">ì˜¤ëŠ˜ì˜ ì¬ë¯¸ìˆëŠ” ì–´ì›ì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>

            <div class="streak-wrap" style="margin-top:25px;">
                <div class="streak-header">
                    <div style="font-size:1rem; font-weight:700; color:var(--text);">ğŸ”¥ í•™ìŠµ ì—´ê¸° (Streak)</div>
                    <div class="streak-btns">
                        <button onclick="changePeriod('3m')" id="btn-3m">3ê°œì›”</button>
                        <button onclick="changePeriod('6m')" id="btn-6m">6ê°œì›”</button>
                        <button onclick="changePeriod('1y')" id="btn-1y">1ë…„</button>
                    </div>
                </div>
                <div class="gh-container">
                    <div class="gh-labels">
                        <span></span><span>Mon</span><span></span><span>Wed</span><span></span><span>Fri</span><span></span>
                    </div>
                    <div class="streak-scroll-view">
                        <div class="streak-grid" id="streakGrid"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-learn" class="page">
            <div class="learn-view">
                <div id="pBarWrap"><div id="pBar" style="height:100%; background:var(--primary); width:0%;"></div></div>
                <div id="phaseTag" style="position:absolute; top:25px; left:30px; font-weight:800; color:var(--primary); font-size:0.85rem; letter-spacing: 1px;">READY</div>

                <div id="wordArea">
                    <div class="word-text" id="mainWord"></div>
                    <div style="font-size:1.6rem; color:var(--accent); font-weight:700; margin-top:15px; min-height: 2rem;" id="mainMean"></div>
                </div>

                <div id="inputArea" style="display:none; margin-top:20px;">
                    <div id="feedbackMsg" style="margin-bottom:20px; font-weight:800; min-height:24px; font-size: 1.1rem;"></div>
                    <input type="text" id="inWord" class="input-box" placeholder="ì˜ì–´ ë‹¨ì–´" autocomplete="off">
                    <input type="text" id="inMean" class="input-box" placeholder="ëœ» ì…ë ¥" autocomplete="off">
                </div>

                <div style="margin-top: 30px; width: 100%;">
                    <button id="actionBtn" class="btn-main">í™•ì¸ <span class="pc-hint">(Space)</span></button>
                    <button id="giveUpBtn" class="btn-sub" onclick="handleGiveUp()" style="display:none;">ëª¨ë¥´ê² ì–´ìš” (ë„˜ì–´ê°€ê¸°)</button>
                </div>
            </div>
        </section>

        <section id="page-manage" class="page">
            <div class="learn-view">
                <h3 style="margin-bottom:20px; font-size: 1.5rem;">ìƒˆ ë‹¨ì–´ì¥ ì¶”ê°€</h3>
                <input type="text" id="setName" class="input-box" placeholder="ì„¸íŠ¸ ì´ë¦„ (ì˜ˆ: Day 1)" style="margin-bottom:10px;">
                <textarea id="rawInput" class="input-box" style="height:160px; resize: none; line-height: 1.6;" placeholder="ì˜ì–´ë‹¨ì–´[Tab]í•œê¸€ëœ»&#10;apple ì‚¬ê³¼&#10;run ë‹¬ë¦¬ë‹¤"></textarea>
                <button onclick="importWords()" class="btn-main">ì €ì¥í•˜ê¸°</button>

                <div style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">
                    <h3 style="margin-bottom:15px; font-size: 1.5rem;">ğŸ“¥ ë‹¨ì–´ì¥ ë‹¤ìš´ë¡œë“œ</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="shareCodeInput" class="input-box" placeholder="ê³µìœ  ì½”ë“œ ì…ë ¥ (ì˜ˆ: A1B2C3)" style="text-transform:uppercase;">
                        <button onclick="downloadSharedBook()" class="btn-main" style="width:100px; background:var(--accent); color:#1e1e24; font-weight:700;">ë°›ê¸°</button>
                    </div>
                    <p style="margin-top:5px; font-size:0.8rem; color:var(--text-dim);">
                        * ì¹œêµ¬ì—ê²Œ ë°›ì€ 6ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.
                    </p>
                </div>

                <div style="margin-top: 40px; border-top: 1px solid var(--border); padding-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: var(--text-dim);">ë‚´ ë‹¨ì–´ì¥ ëª©ë¡</h4>
                    <div id="accordionWrap" style="display: flex; flex-direction: column; gap: 10px;"></div>
                </div>
            </div>
        </section>
    </div>
</main>
<div id="apiKeyPrompt" class="overlay" style="display:none;">
    <div class="popup">
        <h2>Gemini API í‚¤</h2>
        <input type="text" id="popupApiKey" placeholder="open routerì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ì…ë ¥">
        <button id="apiKeyBtn" onclick="saveUserApiKey()">í™•ì¸</button>
    </div>
</div>
<script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/sw.js");
    }
</script>
<script type="module" src="ai.js"></script>
<script src="learn.js"></script>
<script src="app.js"></script>
</body>
</html>